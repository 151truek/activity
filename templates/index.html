{% extends "base.html" %} 
{% load static %} 
{% block content %} 
{% include './shared/level1_modal_form.html' %}

<script src="{% static 'js/chart.js@2.8.0.min.js' %}"></script>

<style>
  #map {
    height: 400px !important;
  }
</style>

<div class="container">
  {% block breadcrumbs %}
  <ul class="breadcrumb">
    <li class="active">My Dashboard</li>
  </ul>
  {% endblock %}

  <!-- Sub navigation -->
  <div class="sub-navigation">
    <div class="sub-navigation-header">
      <h4 class="page-title">My Dashboard</h4>
    </div>

    <div class="sub-navigation-actions">
      <div class="sub-nav-item">
        <div class="btn-group" role="group">
          <button
            type="button"
            class="btn btn-sm btn-default dropdown-toggle"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            {% if selected_program %} Filtered by {{ selected_program.name }} 
            {% else %} Filter by
            {{ user.activity_user.organization.level_1_label }}
            {% endif %}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li>
              <a href="/dashboard/0/">-- All --</a>
            </li>

            {% for program in get_programs %} {% if program.name %}
            <li
              class="{% if selected_program.id == program.id %} active {% endif %}"
            >
              <a href="{% url 'home_dashboard' program.id %}">
                {{ program.name }}</a>
            </li>
            {% endif %} {% endfor %}
          </ul>
        </div>
      </div>

      <!-- sample action buttons -->
      <div class="sub-nav-item">
        <div class="btn-group" role="group" aria-label="">
          <button
            class="btn btn-sm btn-primary"
            data-toggle="modal"
            data-target="#addProgramModal"
          >
            <i class="fa fa-plus"></i> Add New
            {{ user.activity_user.organization.level_1_label }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- workflows -->
  <div class="panel panel-dashboard rounded-0 mb-0">
    <div class="panel-heading white">
      <h4 class="panel-title">Workflows</h4>
    </div>

    <div class="panel-body">
      <div class="row">
        <div class="col-md-2 col-xs-12">
          <div class="row">
            <div class="col-md-12 col-xs-6">
              <a class="box box-info" href="/workflow/level1">
                <p class="box-info-label">{{ request.user.activity_user.organization.level_1_label }}s</p>
                <p class="box-info-number">{{ get_programs | length }}</p>
              </a>
            </div>

            <div class="col-md-12 col-xs-6">
              {% if selected_program %}
                <a class="box box-info" href="/workflow/level2/list/{{selected_program.id}}/none">
                  <p class="box-info-label">{{ request.user.activity_user.organization.level_2_label }}</p>
                  <p class="box-info-number">{{ get_projects | length }}</p>
                </a>
              {% else %}
                <a class="box box-info" href="/workflow/level2/list/0/none">
                  <p class="box-info-label">{{ request.user.activity_user.organization.level_2_label }}</p>
                  <p class="box-info-number">{{ get_projects | length }}</p>
                </a>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-md-10">
          <div class="row-charts">
            <div class="chart">
              <canvas id="projectStatusPie" height="200"></canvas>
            </div>
            <div class="chart">
              <canvas id="projectBudgetActualColumn" height="200"> </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- indicators -->
  <div class="panel panel-dashboard rounded-0 mb-0">
    <div class="panel-heading white">
      <h4 class="panel-title">Indicators</h4>
    </div>

    <div class="panel-body">
      <div class="row">
        <div class="col-md-2 col-xs-12">
          <div class="row">
            <div class="col-md-12 col-xs-6">
              {% if selected_program %}
                <a class="box box-info" href="/indicators/home/{{selected_program.id}}/0/0/" role="button">
                  <p class="box-info-label">Indicators</p>
                  <p class="box-info-number">{{ get_indicators | length }}</p>
                </a>
              {% else %}
                <a class="box box-info" href="/indicators/home/0/0/0/" role="button">
                  <p class="box-info-label">Indicators</p>
                  <p class="box-info-number">{{ get_indicators | length }}</p>
                </a>
              {% endif %}
            </div>

            <div class="col-md-12 col-xs-6">
              <a class="box box-info" role="button">
                <p class="box-info-label">Collected Data</p>
                <p class="box-info-number">{{ get_collected_data_count }}</p>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-10">
          <table class="table" id="indicatorTargetActualsTable">
            <thead>
              <tr>
                <th>Indicator</th>
                <th>Target</th>
                <th>Actual</th>
              </tr>
            </thead>
            <tbody>
              {%  for indicator in get_latest_indicators %}
              <tr>
                <td><a href="">{{indicator.name}}</a></td>
                <td>{{indicator.target}}</td>
                <td>{{indicator.actual}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- components -->
  <div class="panel panel-dashboard rounded-0 mb-0">
    <div class="panel-heading white">
      <h4 class="panel-title">Components</h4>
    </div>

    <div class="panel-body">
      <div class="row">
        <div class="col-md-2 col-xs-12">
          <div class="row">
            <div class="col-md-12 col-xs-6">
              <a class="box box-info" href="/">
                <p class="box-info-label">Active Locations</p>
                <p class="box-info-number">890</p>
                <p class="box-info-text">out of 1000 locations</p>
              </a>
            </div>

            <div class="col-md-12 col-xs-6">
              <a class="box box-info" href="/">
                <p class="box-info-label">Documents</p>
                <p class="box-info-number">1</p>
                <p class="box-info-text">linked to Programs</p>
              </a>
            </div>

            <div class="col-md-12 col-xs-12">
              <a class="box box-info" href="/">
                <p class="box-info-label">Stakeholders</p>
                <p class="box-info-number">10</p>
                <p class="box-info-text">with 205 contacts</p>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-10">
          <div id="map">
            {% include './small_site_profile_map.html' %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  var projectStatusPie = new Chart($('#projectStatusPie'), {
    type: 'pie',
    data: {
      datasets: [
        {
          data: [10, 60, 34, 89, 34],
          backgroundColor: ['yellow', 'blue', 'maroon', 'brown', 'pink'],
        },
      ],
      labels: ['yellow', 'blue', 'maroon', 'brown', 'pink'],
    },
    options: {
      responsive: true,
      legend: {
        position: 'top',
      },
      title: {
        display: true,
        text: 'Project Status',
      },
    },
  });

  var projectBudgetActualColumn = new Chart($('#projectBudgetActualColumn'), {
    type: 'bar',
    data: {
      labels: ['project a', 'project b', 'project c'],
      datasets: [
        {
          label: 'Budget',
          backgroundColor: 'lightblue',
          data: [90, 390, 900],
        },
        {
          label: 'Actual',
          backgroundColor: 'green',
          data: [250, 70, 400],
        },
      ],
    },
    options: {
      responsive: true,
      legend: {
        position: 'top',
      },
      title: {
        display: true,
        text: 'Project Budget vs Actual',
      },
    },
  });
</script>
{% endblock content %}
